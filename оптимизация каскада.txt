Оптимизация каскада:
1. Хранить ключи в виде массивом предподсчитанных префиксных сумм в памяти.
2. block_contains_error - это sparse (+ еще куча всего, что сейчас хранится булонскими массивами)